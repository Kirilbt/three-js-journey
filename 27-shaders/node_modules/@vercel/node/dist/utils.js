"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.entrypointToOutputPath = exports.getRegExpFromMatchers = void 0;
const path_1 = require("path");
const path_to_regexp_1 = require("path-to-regexp");
function getRegExpFromMatchers(matcherOrMatchers) {
    if (!matcherOrMatchers) {
        return '^/.*$';
    }
    const matchers = Array.isArray(matcherOrMatchers)
        ? matcherOrMatchers
        : [matcherOrMatchers];
    const regExps = matchers.flatMap(getRegExpFromMatcher).join('|');
    return regExps;
}
exports.getRegExpFromMatchers = getRegExpFromMatchers;
function getRegExpFromMatcher(matcher, index, allMatchers) {
    if (typeof matcher !== 'string') {
        throw new Error("Middleware's `config.matcher` must be a path matcher (string) or an array of path matchers (string[])");
    }
    if (!matcher.startsWith('/')) {
        throw new Error(`Middleware's \`config.matcher\` values must start with "/". Received: ${matcher}`);
    }
    const regExps = [path_to_regexp_1.pathToRegexp(matcher).source];
    if (matcher === '/' && !allMatchers.includes('/index')) {
        regExps.push(path_to_regexp_1.pathToRegexp('/index').source);
    }
    return regExps;
}
/**
 * If `zeroConfig`:
 *   "api/foo.js" -> "api/foo.js"
 *   "api/foo.ts" -> "api/foo.ts"
 *
 * If *NOT* `zeroConfig`:
 *   "api/foo.js" -> "api/foo"
 *   "api/foo.ts" -> "api/foo"
 */
function entrypointToOutputPath(entrypoint, zeroConfig) {
    if (zeroConfig) {
        const ext = path_1.extname(entrypoint);
        return entrypoint.slice(0, entrypoint.length - ext.length);
    }
    return entrypoint;
}
exports.entrypointToOutputPath = entrypointToOutputPath;
